<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨å°åœç­åœèª²å³æ™‚è³‡è¨Š</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* åŸæœ‰çš„æ¨£å¼ä¿ç•™ */
        .card {
            margin-bottom: 1rem;
            transition: transform 0.2s;
        }
        
        /* æ–°å¢è¼‰å…¥å‹•ç•«æ¨£å¼ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* è¡¨æ ¼æ¨£å¼èª¿æ•´ */
        .table td {
            white-space: nowrap;  /* ç¸£å¸‚å¼·åˆ¶æ©«å¼ */
        }
        
        .table td:last-child {
            white-space: normal;  /* å…§å®¹å¯ä»¥æ›è¡Œ */
            min-width: 200px;     /* è¨­å®šæœ€å°å¯¬åº¦ */
        }

        /* RWD èª¿æ•´ */
        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }
            
            .table {
                font-size: 0.9rem;
            }
            
            .col-md-4 {
                margin-bottom: 20px;
            }
            
            h3 {
                font-size: 1.5rem;
            }
            
            .table td:last-child {
                min-width: 150px;  /* æ‰‹æ©Ÿç‰ˆç¸®å°æœ€å°å¯¬åº¦ */
            }

            /* ç¢ºä¿åœ¨æ‰‹æ©Ÿç‰ˆæ™‚è¡¨æ ¼å¯ä»¥æ°´å¹³æ²å‹• */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        @media (max-width: 576px) {
            .table {
                font-size: 0.8rem;
            }
            
            h3 {
                font-size: 1.2rem;
            }
            
            .table td:last-child {
                min-width: 120px;  /* æ›´å¹•é€²ä¸€æ­¥ç¸®å°å¯¬ */
            }

            /* èª¿æ•´å®¹å™¨é‚Šè· */
            .container {
                padding: 0 5px;
            }

            /* èª¿æ•´æ¨™é¡Œå¤§å° */
            h1 {
                font-size: 1.5rem;
            }
        }

        /* è¡¨æ ¼å…§å®¹ç¾åŒ– */
        .table-warning {
            background-color: #fff3cd !important;
        }
        
        .table td, .table th {
            vertical-align: middle;
        }
        
        /* å€åŸŸæ¨™é¡Œæ¨£å¼ */
        h3 {
            margin-bottom: 1rem;
            padding: 0.5rem;
            border-radius: 5px;
            background-color: #f8f9fa;
        }

        /* å®¹å™¨é–“è·èª¿æ•´ */
        .row > div {
            margin-bottom: 2rem;
        }

        /* æ–°å¢æš—è‰²æ¨¡å¼ç›¸é—œæ¨£å¼ */
        :root {
            --dark-bg: #1a1a1a;
            --dark-text: #ffffff;
            --dark-table-border: #4c4c4c;
            --dark-hover: rgba(64, 158, 255, 0.2);
        }

        /* æš—è‰²ä¸»é¡Œé¡ */
        .dark-theme {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .dark-theme .table {
            color: var(--dark-text);
            background-color: var(--dark-bg);
        }

        .dark-theme .table td, 
        .dark-theme .table th {
            border-color: var(--dark-table-border);
        }

        .dark-theme .text-muted {
            color: #a0a0a0 !important;
        }

        .dark-theme .table-warning,
        .dark-theme td[style*="background-color: rgb(255, 243, 205)"] {
            background-color: #2c2c1f !important;
            color: #ffd700 !important;
        }

        .dark-theme h3 {
            background-color: #2c2c2c;
        }

        /* ä¸»é¡Œåˆ‡æ›æŒ‰éˆ•æ¨£å¼ */
        .theme-switch-wrapper {
            display: flex;
            justify-content: flex-end;
            padding: 0 1rem;
            margin-bottom: 1rem;
        }

        .theme-switch-btn {
            background: none;
            border: 2px solid #666;
            border-radius: 20px;
            padding: 5px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-theme .theme-switch-btn {
            border-color: #888;
            color: var(--dark-text);
        }

        .light-icon, .dark-icon {
            font-size: 1.2rem;
        }

        .dark-theme .light-icon,
        .light-theme .dark-icon {
            display: none;
        }

        /* å…¨åŸŸå­—é«”è¨­å®š */
        body {
            font-family: 'Noto Sans TC', system-ui, -apple-system, sans-serif;
        }

        /* ç¢ºä¿æ¨™é¡Œä¹Ÿä½¿ç”¨ç›¸åŒå­—é«” */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Noto Sans TC', system-ui, -apple-system, sans-serif;
        }

        /* è¡¨æ ¼å…§å®¹å­—é«” */
        .table {
            font-family: 'Noto Sans TC', system-ui, -apple-system, sans-serif;
        }

        /* å­—é‡èª¿æ•´ */
        h1 {
            font-weight: 700;  /* ç²—é«” */
        }
        
        h3 {
            font-weight: 500;  /* ä¸­ç­‰ç²—ç´° */
        }
        
        .table th {
            font-weight: 500;  /* è¡¨æ ¼æ¨™é¡Œä¸­ç­‰ç²—ç´° */
        }
        
        .table td {
            font-weight: 400;  /* è¡¨æ ¼å…§å®¹æ­£å¸¸ç²—ç´° */
        }

        /* åœ¨ style å€å¡Šæ·»åŠ æ–°çš„æ¨£å¼ */
        .status-normal {
            background-color: #e8f5e9 !important; /* æ·¡ç¶ è‰²èƒŒæ™¯ */
        }

        .status-alert {
            color: #fb6868;
        }

        .region-name {
            
            color: #4a90e2;  /* æ·¡è—è‰² */
        }

        .status-alert {
            color: #fb6868;  /* ä¿æŒåŸæœ‰çš„ç´…è‰²è­¦ç¤º */
        }

        /* æ›´æ–°æ™‚é–“å€å¡Šæ¨£å¼ */
        .update-info {
            margin-bottom: 2rem;
            text-align: right;
        }
        
        .update-info h4 {
            font-weight: normal;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .update-info a {
            color: #4a90e2;
            text-decoration: none;
        }
        
        .update-info a:hover {
            text-decoration: underline;
        }
        
        /* æš—è‰²æ¨¡å¼é©é… */
        .dark-theme .update-info a {
            color: #7cb9ff;
        }

        /* æ—¥æœŸæ¨™é¡Œæ¨£å¼ */
        .Header_YMD {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }
        
        /* æš—è‰²æ¨¡å¼é©é… */
        .dark-theme .Header_YMD {
            color: var(--dark-text);
        }
        
        @media (max-width: 576px) {
            .Header_YMD {
                font-size: 1rem;
            }
        }

        /* è¡¨æ ¼ç¾åŒ–æ¨£å¼ */
        .table-responsive {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .table-responsive:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
        }

        .table {
            margin-bottom: 0;  /* ç§»é™¤è¡¨æ ¼åº•éƒ¨é‚Šè· */
        }

        /* æš—è‰²æ¨¡å¼é©é… */
        .dark-theme .table-responsive {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .dark-theme .table-responsive:hover {
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.4);
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="theme-switch-wrapper">
            <button class="theme-switch-btn" id="themeToggle">
                <span class="light-icon">â˜€ï¸</span>
                <span class="dark-icon">ğŸŒ™</span>
            </button>
        </div>
        <h1 class="text-center mb-4">å…¨å°åœç­åœèª²å³æ™‚è³‡è¨Š</h1>
        
        <!-- è¼‰å…¥å‹•ç•« -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
        </div>
        
        <!-- è³‡æ–™é¡¯ç¤ºå€åŸŸ -->
        <div id="data-container" style="display: none;">
            <div class="Header_YMD" id="dateHeader">
                è¼‰å…¥ä¸­...
            </div>
            <div class="update-info">
                <h4>
                    æ›´æ–°æ™‚é–“ï¼š<span id="updateTime">è¼‰å…¥ä¸­...</span>
                    <br>
                    <a href="https://www.dgpa.gov.tw/informationlist?uid=374" target="_blank">æ­·æ¬¡å¤©ç„¶ç½å®³åœæ­¢ä¸Šç­ä¸Šèª²è¨Šæ¯</a>
                </h4>
            </div>
            <div class="row">
                <!-- åŒ—éƒ¨åœ°å€ -->
                <div class="col-12 col-md-4">
                    <h3 class="text-center">åŒ—éƒ¨åœ°å€ğŸ²</h3>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th class="text-center">ç¸£å¸‚</th>
                                    <th class="text-center">åœç­åœèª²ç‹€æ…‹</th>
                                </tr>
                            </thead>
                            <tbody id="northTable"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ä¸­éƒ¨åœ°å€ -->
                <div class="col-12 col-md-4">
                    <h3 class="text-center">ä¸­éƒ¨åœ°å€ğŸª¨</h3>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th class="text-center">ç¸£å¸‚</th>
                                    <th class="text-center">åœç­åœèª²ç‹€æ…‹</th>
                                </tr>
                            </thead>
                            <tbody id="centralTable"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- å—éƒ¨åœ°å€ -->
                <div class="col-12 col-md-4">
                    <h3 class="text-center">å—éƒ¨åœ°å€ğŸ–</h3>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th class="text-center">ç¸£å¸‚</th>
                                    <th class="text-center">åœç­åœèª²ç‹€æ…‹</th>
                                </tr>
                            </thead>
                            <tbody id="southTable"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- æ±éƒ¨åœ°å€ -->
                <div class="col-12 col-md-4">
                    <h3 class="text-center">æ±éƒ¨åœ°å€ğŸŒ¼</h3>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th class="text-center">ç¸£å¸‚</th>
                                    <th class="text-center">åœç­åœèª²ç‹€æ…‹</th>
                                </tr>
                            </thead>
                            <tbody id="eastTable"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- å¤–å³¶åœ°å€ -->
                <div class="col-12 col-md-4">
                    <h3 class="text-center">å¤–å³¶åœ°å€ğŸï¸</h3>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th class="text-center">ç¸£å¸‚</th>
                                    <th class="text-center">åœç­åœèª²ç‹€æ…‹</th>
                                </tr>
                            </thead>
                            <tbody id="islandTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CORS_PROXY = "https://corsproxy.io/?";
        const DGPA_URL = "https://www.dgpa.gov.tw/typh/daily/nds.html";
        
        // å®šç¾©ç¸£å¸‚åˆ†é¡
        const regions = {
            north: ['è‡ºåŒ—å¸‚', 'æ–°åŒ—å¸‚', 'åŸºéš†å¸‚', 'æ¡ƒåœ’å¸‚', 'æ–°ç«¹å¸‚', 'æ–°ç«¹ç¸£'],
            central: ['è‹—æ —ç¸£', 'è‡ºä¸­å¸‚', 'å½°åŒ–ç¸£', 'å—æŠ•ç¸£', 'é›²æ—ç¸£'],
            south: ['å˜‰ç¾©å¸‚', 'å˜‰ç¾©ç¸£', 'è‡ºå—å¸‚', 'é›„å¸‚', 'å±æ±ç¸£'],
            east: ['å®œè˜­ç¸£', 'èŠ±è“®ç¸£', 'è‡ºæ±ç¸£'],
            island: ['æ¾æ¹–ç¸£', 'é‡‘é–€ç¸£', 'é€£æ±Ÿç¸£']
        };

        async function processData(html) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const table = doc.querySelector('#Table');
            const alerts = {};
            
            // ç²å–æ¨™é¡Œæ—¥æœŸ
            const headerElement = doc.querySelector('.Header_YMD');
            if (headerElement) {
                const headerText = headerElement.textContent.trim();
                document.getElementById('dateHeader').textContent = headerText;
            }
            
            // ç²å–æ›´æ–°æ™‚é–“
            const updateTimeElement = doc.querySelector('.Content_Updata');
            if (updateTimeElement) {
                const timeText = updateTimeElement.textContent.match(/æ›´æ–°æ™‚é–“ï¼š([\d\/: ]+)/);
                if (timeText && timeText[1]) {
                    document.getElementById('updateTime').textContent = timeText[1].trim();
                }
            }
            
            if (!table) return alerts;
            
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 2) {
                    const city = cells[0].textContent.trim();
                    const status = cells[1].textContent.trim()
                        .replace(/ã€‚\s*/g, 'ã€‚\n')
                        .replace(/ã€‚$/g, 'ã€‚')
                        .replace(/:/g, '<br>');
                    
                    const hasAlert = status.includes('åœæ­¢ä¸Šç­') || status.includes('åœæ­¢ä¸Šèª²');
                    
                    alerts[city] = {
                        status: status,
                        hasAlert: hasAlert
                    };
                }
            });
            
            return alerts;
        }

        // æ›´æ–°è³‡æ–™ç²å–æ–¹
        async function fetchData() {
            try {
                const response = await fetch(DGPA_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const html = await response.text();
                const alerts = await processData(html);
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('data-container').style.display = 'block';
                updateTables(alerts);
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('loading').innerHTML = "ç„¡æ³•è¼‰å…¥è³‡æ–™ï¼Œè«‹ç¨å¾Œå†è©¦";
            }
        }

        // ä¿®æ”¹è¡¨æ ¼æ›´æ–°å‡½æ•¸
        function updateTables(alerts) {
            Object.keys(regions).forEach(region => {
                const tableBody = document.getElementById(`${region}Table`);
                if (tableBody) {
                    tableBody.innerHTML = regions[region].map(city => {
                        const alert = alerts[city];
                        const status = alert ? alert.status : 'æ­£å¸¸ä¸Šç­ä¸Šèª²';
                        
                        const isNormal = status.trim() === 'ä»Šå¤©ç…§å¸¸ä¸Šç­ã€ç…§å¸¸ä¸Šèª²ã€‚';
                        const hasAlert = status.includes('åœæ­¢ä¸Šç­') || status.includes('åœæ­¢ä¸Šèª²');
                        
                        // ä¿®æ”¹ç‹€æ…‹æ–‡å­—è™•ç†é‚è¼¯
                        const formattedStatus = status.split('\n').map(line => {
                            if (line.includes('åœæ­¢ä¸Šç­') || line.includes('åœæ­¢ä¸Šèª²')) {
                                const parts = line.split('<br>');
                                if (parts.length > 1) {
                                    return `<span class="region-name">${parts[0]}</span><br><span class="status-alert">${parts[1]}</span>`;
                                } else {
                                    return `<span class="status-alert">${line}</span>`;
                                }
                            }
                            return line;
                        }).join('\n');

                        return `
                            <tr>
                                <td class="text-center">${city}</td>
                                <td class="text-center ${isNormal ? 'status-normal' : ''} ${hasAlert ? 'table-warning' : ''}" 
                                    style="white-space: pre-line">${formattedStatus}</td>
                            </tr>
                        `;
                    }).join('');
                }
            });
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
            // æ¯5åˆ†é˜æ›´æ–°ä¸€æ¬¡è³‡æ–™
            setInterval(fetchData, 300000);
        });

        // æ·»åŠ ä¸»é¡Œåˆ‡æ›åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('themeToggle');
            
            // æª¢æŸ¥æœ¬åœ°å­˜å„²çš„ä¸»é¡Œè¨­ç½®
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.body.className = savedTheme;
            } else {
                // å¦‚æœæ²’æœ‰ä¿å­˜çš„ä¸»é¡Œï¼Œå‰‡ä½¿ç”¨ç³»çµ±é è¨­
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.body.className = 'dark-theme';
                } else {
                    document.body.className = 'light-theme';
                }
            }
            
            // åˆ‡æ›ä¸»é¡Œ
            themeToggle.addEventListener('click', () => {
                if (document.body.className === 'light-theme') {
                    document.body.className = 'dark-theme';
                    localStorage.setItem('theme', 'dark-theme');
                } else {
                    document.body.className = 'light-theme';
                    localStorage.setItem('theme', 'light-theme');
                }
            });
            
            // ç›£è½ç³»çµ±ä¸»é¡Œè®ŠåŒ–
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (!localStorage.getItem('theme')) {
                    document.body.className = e.matches ? 'dark-theme' : 'light-theme';
                }
            });
        });
    </script>
</body>
</html> 